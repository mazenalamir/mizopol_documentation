---
title: g2sys
subtitle: Detecting invariant relationships in the Nasa Turbofan Jet Engine Dataset. 
---

***

# Dataset / objective

:::{.columns}
::: {.column width=63%}
This use case involves the [dataset provided by Nasa](https://www.kaggle.com/datasets/behrad3d/nasa-cmaps) where run-to-failure history of degradation is captured. Four datasets are provided which correspond to different conditions. 

:::
::: {.column width=2%}
 
:::
::: {.column width=35%}
![](images/turbofan.png)
:::
::: 

:::{.callout-note title="Objective"}
The original objective of this Nasa Datasets is to estimate the **R**emaining **U**seful **L**ife (**RUL**) which is not our objective in this usecase as we aim at showing **how the sensors relate to each other** and what are the invariant relationships that hold depsite of the aging so that one can only focus on non redundant information. 

::: 

The following movie shows how some invariant relationships that are present in the nasa dateset can be rapidly obtained using the **g2sys** module. 

<video controls width="100%" style="border: 3px solid #3f7086ff; border-radius: 4px;">
  <source src="https://www.mazenalamir.fr/videos/graph_nasa_2.mp4" type="video/mp4"/>
  Your browser does not support the video tag.
</video>

For those who are interested in the pre-processing of the $\texttt{kaggle}$ data set, the following section might be helpful.


# Dataset preparation for g2sys 

As the dataset labelled as *train* (in the Nasa repository) contains the whole lifecycle until final degradation, we stick to these datasets. The dataset labelled *test* are there for the RUL-related studies (see above). 

The following script is used to create the four datasets. Notice that the sensors have been labeled more simply and that the first two columns are removed as they represents respectively the time and the cycle endpoints. 

```python
import pandas as pd 
import numpy as np 

for iexp in [1, 2, 3, 4]:

    df = pd.read_csv(f'train_FD00{iexp}.txt', sep=' ')

    df.reset_index(drop=True, inplace=True)
    df.columns = [f'c{i+1}' for i in range(len(df.columns))]

    fig = go.Figure()
    t = np.arange(0, len(df))
    i =np.random.randint(0,len(df.columns))
    fig.add_trace(go.Scatter(x=t, y=df.loc[:,f'c{i+1}'].values, name=f'c{i}'))

    df = df[[f'c{i+1}' for i in np.arange(2, len(df.columns)-2)]]
    df.to_csv(f'nasa_{iexp}.csv')
```

:::{.callout-tip title='The dataset used for illustration'}
This leads to four datasets among which, only the second one, namely `nasa_2.csv` is used here for the sake of illustration. 
:::

# Results & Discussion

## System's graph 

The following graph of connexion between sensors is obtained (see [the section](graph_intro.qmd)) dedicated to the presentation of the graph of connexion between sensors for more details: 

![Graph representing the relationships as discovered using the **g2sys** module from the `nasa_2.csv` dataset. Notice that the nodes with thick boundaries refer to sensors indexing dynamic relationships while the other refer to sensors that can be represented through static raltionsips (expressing them as functions of the sets of sensors that send arrows to them).](images/nasa2_graph.png){width=60% #fig-graph_nasa_2}


Notice that as it is shown in the screenshot below, only 15% of the data is used for discovering the relationships while the residuals shown after are computed for the whole datasets. 

![Screenshot of the **g2sys** module showing the amount of training data (15%) used in the discovery of the relationships. As the successive portions of the dataset represents different turbofans recordings, The persistency of the smalleness of the residuals as shown hereafter witnesses in favour of the relevance of these invariant relationships over the whole set of engines.](images/screenshot_train_nasa_2.png){#fig-screenshot}

## Viewing residuals 

Recall that the residual is expressed by the normalized expression:

$$
\dfrac{\texttt{percentile}(y-\hat y, 95)}{\texttt{median}(\vert y\vert )}
$$

This means that given the plots below, 95% of the error are lower than 8% of the absolute value of the label's median. As a matter of fact, except for two relationships, the relationships precision is such that 95% of the error are lower than 5% of the label's median.

:::{.callout-tip title="About the residual's legend"}
The syntax of the residual legens is as follows 
$$
\texttt{sensor}|\texttt{card}|\texttt{deg}|\texttt{d}|\texttt{nd}
$$

where 

- $\texttt{sensor}$ is the sensor's name.
- $\texttt{card}$ is the number of active monomials (number of active coefficients)
- $\texttt{d}$ is the elementary delay used in the solution[^ifnond]
- $\texttt{nd}$ is the the number of delays 
:::

<iframe src="html_files/all_residual_nasa_2.html" width="100%" height="620px" style="border:none;"></iframe>



[^graph]: See the section dedicated to the presentation of the concept of [graph of system](graph_intro.qmd).

[^ifnond]: If $\texttt{d}=0$, the parameter $\texttt{nd}$ has no effect.

[^dynamicrec]: See the [Overview](overview.qmd) section for a description of these concepts. 


