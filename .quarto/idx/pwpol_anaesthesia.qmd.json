{"title":"Piece-wise polynomial invariants","markdown":{"yaml":{"title":"Piece-wise polynomial invariants","subtitle":"Usin pwpol to characterize normality in anaesthesia-related sensors"},"headingText":"Objective","containsRefs":false,"markdown":"\n\n***\n\n\n:::{.columns}\n\n:::{.column width=65%}\nIn this section, it is shown how the identification of multivariate piece-wise polynomial invariants involving a set of sensors might be used to characterize the normality and hence help **detecting abnormal events during intervention in the operation room**. \n\nThe dataset used in this work is a subset of the well known $\\texttt{vitalDB}$ dataset @lee_vitaldb_2022\n:::\n\n:::{.column width=5%}\n \n:::\n\n:::{.column width=30%}\n![](images/anaesthesia.png)\n:::\n\n:::\n\n\nThe objective behind establishing invariant relationships can be stated as follows:\n\n:::{.columns}\n\n:::{.column width=60%}\n:::{.callout-note title='Problem statement'}\nUse some recorded sensors' measurements under *normal conditions* in order to:\n\n- Characterize normality \n- Use the characterization to \n    - detect events (anomalies) or \n    - derive an automatic annotation tool.\n:::\n:::\n\n:::{.column width=5%}\n \n:::\n\n:::{.column width=35%}\n![](images/ana_anomaly_detection.png)\n:::\n\n:::\n\nObviously, these goal can be progressively achieved by iterations between the algorithm and experts annotating/correcting the early labelling by the automatic tool. This is sketched in the following scheme: \n\n![The principle of annotation/training/annotation cycle towards building a reliable events detection algorithm. (1) A first version of the algorithm is used to fit a model (2). This model can be used to annotate (3) a new subset of the dataset experts confirm/correct/annotate this new part (4). The resulting extended set is used to re-train the automatic annotator (5) and so on.](images/principle_annotation.png)\n\n\n:::{.callout-important title='Preliminary PoC'}\nAs the roadmap needs several iterations and these require a long term committment from practicionners. The entire process has not yet been undertaken. Only the first two steps of the above described cycle have been implemented. \n\nConsequently, the methods and the results discussed in this section can only be viewed as a sort of proof of concept and a roadmap rather than a ready-to-use tool.\n:::\n\n## The Dataset\n\nWe work on a dataset involving **19 patients** having different kinds of surgeries. The sensors represented in the dataset are linked to the anaesthesia monitoring. More precisely, the following measurement sensors are involved: \n\n**BIS**\n: Bi-Spectral Index (EEG measurements interpreted),\n\n**MAP**\n: Mean Arterial Pressure,\n\n**HR**\n: Heart Rate,\n\n**RR**\n: Respiration Rate (RR),\n\n**ETCO2**\n: End-Tidal Carbon Dioxide (ETCO2).\n\nNevertheless, it is worth amphasizing that the methodology is perfetcly generic and might be successfully applied to any extended set of sensors[^sampling] (and not necessarily those linked to anaesthesia).\n\n## The priniciple \n\nThe principle of the method is sketched on the set of tabs below. Notice in particular the central role played by the identification of piece-wise polynomial relationships which is the precise task assigned to the `pwpol` module. \n\n:::{.panel-tabset}\n\n## Sensors Time-series \n\n![Zoom on several patients time-series which are concatenated to form the working dataset. The black solid line represent the events-related label which is provided by the annotators (doctors) working on the dataset.](images/fit2.png)\n\n## Fit models \n\n![Five piece-wise polynomial models are fitted in each of which, one of the first five sensors is used as targeted label ($y$). DH stands for *Healthy Data*, namely, data with no or very few events. ](images/fit3.png)\n\n## Residuals time-series\n\n![By spanning the available measurement instants, the residuals of the relationships are computed in order to form the residual time-series for all the identified piece-wise relationships. These residuals profiles are used to analyze the ability of the resulting anomaly detector to raise relevant event-detection related alarms.](images/fit5.png)\n\n:::\n\nBased on the *Big Picture* explained in the figures above, let us focus on the identification task and evaluate the ability of the `pwpol` module to capture **tight** invariant relationships linking the available sensors information in spite of the variety of patients, operations and anaesthesiologists involved. \n\n## Characteristics of identified models \n\nThe table below shows the characteristics of of the piece-wise polynomial invariant relationships for different targeted sensors:\n\n$$\n\\texttt{BIS}, \\texttt{MAP}, \\texttt{HR}, \\texttt{RR}, \\texttt{ETCO2}\n$$\nand different precision thresholds: \n$$\n\\texttt{th}\\in \\{0.02, 0.05, 0.1, 0.15, 0.2, 0.3\\}\n$$\n\nThese models have been identified on the first $25\\%$ of the patients (this corresponds to a patient-based split between train and test datasets).\n\n<div style=\"text-align: center;\">\n<iframe src=\"html_files/dfRes.html\" height=\"650\" width=\"70%\" style=\"border: 0.3px solid black;\"></iframe>\n</div>\n\nNotice that in spite of the complex nature of the relationships, the number of monomials that is needed to capture the invariant relationship with high precision[^seemore] is rather moderate if not quite small and the computation time never exceeds half a minute. \n\n\n## Visualizing some residuals {#sec-visualizing}\n \n:::{.panel-tabset}\n\n### th=0.02 | filter_win = 100\n\n<iframe src=\"html_files/residual_0_02.html\" height=\"1200\" width=\"130%\" style=\"border: 0.0px solid black;\"></iframe>\n\n### th=0.05 | filter_win = 1000\n\n<iframe src=\"html_files/residual_0_05.html\" height=\"1200\" width=\"130%\" style=\"border: 0.0px solid black;\"></iframe>\n\n### th=0.1 | filter_win = 1000\n\n<iframe src=\"html_files/residual_0_1.html\" height=\"1200\" width=\"130%\" style=\"border: 0.0px solid black;\"></iframe>\n\n:::\n\n## Event detection results \n\nThe previously defined normality characterization might be used to fire alarms in the operation rooms. The following figures show the resulting events detection statistics for different levels of acceptable false alarm rates. \n\nNotice that there are different columns corresponding each to a level of precision so that each one can be used alone to fire alarm signals. The threshold used for each individual *worker* is the one written in purple at the top right corners of each table. \n\nThe last column corresponds to the case where an alarm is raised as soon as one of the workers fires an alarm. \n\nThe effective false alarm is the one associated to the last row in the tables. This differs from the previously mentioned one (in purple) which is used by each worker to fire the alarm.\n\n:::{.callout-tip}\nThe events-related intervals have been annotated by doctors from the CHU-Grenoble on the recordings of 19 patients.\n:::\n\n:::{.panel-tabset}\n\n### admissible FA=10\n\n![](images/FA10_medical.png)\n\n### admissible FA=15\n\n![](images/FA15_medical.png)\n\n### admissible FA=20\n\n![](images/FA20_medical.png)\n\n:::\n\n[^sampling]: The sensors need to be presented using a common acquisition period. Therefore, in case of discrepancy, some data processing (under-sampling or interpolation) might be necessary in this case. \n\n[^seemore]: This is better assessed by examining the representative figures shown in @sec-visualizing.","srcMarkdownNoYaml":"\n\n***\n\n## Objective \n\n:::{.columns}\n\n:::{.column width=65%}\nIn this section, it is shown how the identification of multivariate piece-wise polynomial invariants involving a set of sensors might be used to characterize the normality and hence help **detecting abnormal events during intervention in the operation room**. \n\nThe dataset used in this work is a subset of the well known $\\texttt{vitalDB}$ dataset @lee_vitaldb_2022\n:::\n\n:::{.column width=5%}\n \n:::\n\n:::{.column width=30%}\n![](images/anaesthesia.png)\n:::\n\n:::\n\n\nThe objective behind establishing invariant relationships can be stated as follows:\n\n:::{.columns}\n\n:::{.column width=60%}\n:::{.callout-note title='Problem statement'}\nUse some recorded sensors' measurements under *normal conditions* in order to:\n\n- Characterize normality \n- Use the characterization to \n    - detect events (anomalies) or \n    - derive an automatic annotation tool.\n:::\n:::\n\n:::{.column width=5%}\n \n:::\n\n:::{.column width=35%}\n![](images/ana_anomaly_detection.png)\n:::\n\n:::\n\nObviously, these goal can be progressively achieved by iterations between the algorithm and experts annotating/correcting the early labelling by the automatic tool. This is sketched in the following scheme: \n\n![The principle of annotation/training/annotation cycle towards building a reliable events detection algorithm. (1) A first version of the algorithm is used to fit a model (2). This model can be used to annotate (3) a new subset of the dataset experts confirm/correct/annotate this new part (4). The resulting extended set is used to re-train the automatic annotator (5) and so on.](images/principle_annotation.png)\n\n\n:::{.callout-important title='Preliminary PoC'}\nAs the roadmap needs several iterations and these require a long term committment from practicionners. The entire process has not yet been undertaken. Only the first two steps of the above described cycle have been implemented. \n\nConsequently, the methods and the results discussed in this section can only be viewed as a sort of proof of concept and a roadmap rather than a ready-to-use tool.\n:::\n\n## The Dataset\n\nWe work on a dataset involving **19 patients** having different kinds of surgeries. The sensors represented in the dataset are linked to the anaesthesia monitoring. More precisely, the following measurement sensors are involved: \n\n**BIS**\n: Bi-Spectral Index (EEG measurements interpreted),\n\n**MAP**\n: Mean Arterial Pressure,\n\n**HR**\n: Heart Rate,\n\n**RR**\n: Respiration Rate (RR),\n\n**ETCO2**\n: End-Tidal Carbon Dioxide (ETCO2).\n\nNevertheless, it is worth amphasizing that the methodology is perfetcly generic and might be successfully applied to any extended set of sensors[^sampling] (and not necessarily those linked to anaesthesia).\n\n## The priniciple \n\nThe principle of the method is sketched on the set of tabs below. Notice in particular the central role played by the identification of piece-wise polynomial relationships which is the precise task assigned to the `pwpol` module. \n\n:::{.panel-tabset}\n\n## Sensors Time-series \n\n![Zoom on several patients time-series which are concatenated to form the working dataset. The black solid line represent the events-related label which is provided by the annotators (doctors) working on the dataset.](images/fit2.png)\n\n## Fit models \n\n![Five piece-wise polynomial models are fitted in each of which, one of the first five sensors is used as targeted label ($y$). DH stands for *Healthy Data*, namely, data with no or very few events. ](images/fit3.png)\n\n## Residuals time-series\n\n![By spanning the available measurement instants, the residuals of the relationships are computed in order to form the residual time-series for all the identified piece-wise relationships. These residuals profiles are used to analyze the ability of the resulting anomaly detector to raise relevant event-detection related alarms.](images/fit5.png)\n\n:::\n\nBased on the *Big Picture* explained in the figures above, let us focus on the identification task and evaluate the ability of the `pwpol` module to capture **tight** invariant relationships linking the available sensors information in spite of the variety of patients, operations and anaesthesiologists involved. \n\n## Characteristics of identified models \n\nThe table below shows the characteristics of of the piece-wise polynomial invariant relationships for different targeted sensors:\n\n$$\n\\texttt{BIS}, \\texttt{MAP}, \\texttt{HR}, \\texttt{RR}, \\texttt{ETCO2}\n$$\nand different precision thresholds: \n$$\n\\texttt{th}\\in \\{0.02, 0.05, 0.1, 0.15, 0.2, 0.3\\}\n$$\n\nThese models have been identified on the first $25\\%$ of the patients (this corresponds to a patient-based split between train and test datasets).\n\n<div style=\"text-align: center;\">\n<iframe src=\"html_files/dfRes.html\" height=\"650\" width=\"70%\" style=\"border: 0.3px solid black;\"></iframe>\n</div>\n\nNotice that in spite of the complex nature of the relationships, the number of monomials that is needed to capture the invariant relationship with high precision[^seemore] is rather moderate if not quite small and the computation time never exceeds half a minute. \n\n\n## Visualizing some residuals {#sec-visualizing}\n \n:::{.panel-tabset}\n\n### th=0.02 | filter_win = 100\n\n<iframe src=\"html_files/residual_0_02.html\" height=\"1200\" width=\"130%\" style=\"border: 0.0px solid black;\"></iframe>\n\n### th=0.05 | filter_win = 1000\n\n<iframe src=\"html_files/residual_0_05.html\" height=\"1200\" width=\"130%\" style=\"border: 0.0px solid black;\"></iframe>\n\n### th=0.1 | filter_win = 1000\n\n<iframe src=\"html_files/residual_0_1.html\" height=\"1200\" width=\"130%\" style=\"border: 0.0px solid black;\"></iframe>\n\n:::\n\n## Event detection results \n\nThe previously defined normality characterization might be used to fire alarms in the operation rooms. The following figures show the resulting events detection statistics for different levels of acceptable false alarm rates. \n\nNotice that there are different columns corresponding each to a level of precision so that each one can be used alone to fire alarm signals. The threshold used for each individual *worker* is the one written in purple at the top right corners of each table. \n\nThe last column corresponds to the case where an alarm is raised as soon as one of the workers fires an alarm. \n\nThe effective false alarm is the one associated to the last row in the tables. This differs from the previously mentioned one (in purple) which is used by each worker to fire the alarm.\n\n:::{.callout-tip}\nThe events-related intervals have been annotated by doctors from the CHU-Grenoble on the recordings of 19 patients.\n:::\n\n:::{.panel-tabset}\n\n### admissible FA=10\n\n![](images/FA10_medical.png)\n\n### admissible FA=15\n\n![](images/FA15_medical.png)\n\n### admissible FA=20\n\n![](images/FA20_medical.png)\n\n:::\n\n[^sampling]: The sensors need to be presented using a common acquisition period. Therefore, in case of discrepancy, some data processing (under-sampling or interpolation) might be necessary in this case. \n\n[^seemore]: This is better assessed by examining the representative figures shown in @sec-visualizing."},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","number-sections":true,"html-math-method":"mathjax","css":["styles/styles.css"],"toc":true,"output-file":"pwpol_anaesthesia.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.32","bibliography":["biblio.bib"],"resources":["images/sparsity_osc_*.png","images/anomalies_detection_pbstat_*.png","images/sources_of_anomalies_*.png","images/zema_*.png"],"theme":"flatly","link-citations":true,"csl":"styles/apa.csl","title":"Piece-wise polynomial invariants","subtitle":"Usin pwpol to characterize normality in anaesthesia-related sensors"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}